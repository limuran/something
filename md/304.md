## 304

-   到底什么是 340

-   为甚返回 304

-   客户端 ————— 代理服务器 ———— 原始服务器

    ​

### 概念

-   304 是 http 的一种状态码。
-   客户端发送请求且请求资源没有被修改过，缓存仍然是有效的。

### 详细解释

1. 在客户端发起请求，请求头中会带上：

    **If-Modified-Since**的请求部首，其值为服务器上一次返回的**Last-Modified**中的日期。

    **If-None-Match**请求头,值为服务器上次返回的**ETag**响应头的值。

    `** 服务器并不会真的将请求头的信息作为日期来比对，而是进行字符串比对。`

2. 服务器会读取请求头中的信息，来判断所请求的资源是否是最新且没有更改。这样服务器就会返回**304 Not Modified** 的状态码。

3. 如果服务器判断请求的资源已经过期或后更改，那么就会返回**200 Ok**。该资源当前最新的内容。客户端收到 200 响应后，就会用新的响应体覆盖掉旧的缓存资源。

    ​

只有在客户端缓存了对应资源且该资源的响应头中包含了**Last-Modified**或**ETag**的情况下，才可能发送条件请求。如果这两个头都不存在，则必须无条件请求该资源，服务器也就必须返回完整的资源数据。

### 名词解释

1. ETag：实体标签（版本标识符）。是附加到文档上的任意标签（引用字符串）。它可能包含了文档的序列号或版本号，或是文档内容的校验和及其他指纹信息。

### 扩展

-   控制缓存的能力 —— Cache-Control：
    1. Cache-Control: no-store 禁止缓存对响应进行复制，绝对禁止缓存
    2. Cache-Control: no-cache 在未与原始服务器进行新鲜度验证之前，缓存不能提供使用
    3. Cache-Control: max-age 从服务器将文档传来之时起，可以认为此文档处于新鲜状态的秒数
    4. Cache-Control: must-revalidate 严格遵守过期信息，如果在检查新鲜度的过程中，原始服务器不可用则需要返回**504 Gateway Timeout**
    5. Cache-Control: public 响应会被缓存，并且在多用户间共享。也就是下图的意思。如果没有指定 public 还是 private，则默认为 public。
    6. Cache-Control:private 响应只作为私有的缓存，不能在用户间共享。如果要求 HTTP 认证，响应会自动设置为 private。
-   Exprise —— 指定的值为实际的过期日期而不是秒数 ( cache-control 的优先级更高 )。
-   不附加过期信息，让缓存确定自己的过期时间。

## 总结

-   使用缓存流程

![图片61](/Users/Desktop/图片61.png)

（down 来的图片）

-   cache-control 指令使用

    ![图片51](/Users/Desktop/图片51.png)

（又是 down 来的）
